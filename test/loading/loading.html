<!DOCTYPE html>
<html>
  <head>
    <title>Test</title>
    <style>
      .customers .customer.inactive {

      }
        .customers .customer.inactive .details {
          display:none;
        }
      .customers .customer.active {

      }
        .customers .customer.active .details {
        }
    </style>
  </head>
  <body style="background-color:#ccc">
    <h2 class="status" style="color:red;">
      <span style="color:black">Adrianna</span>
      loves
      <span style="color:green">Tristan</span>
      &amp;
      <span style="color:purple">Brian</span>
    </h2>
    <div id="activeCustomers" class="customers">
      <script type="text/html-template">
        <div class="customer inactive">
          <h2 class="name"></h2>
          <input name="status">
          <a href="#" class="trigger" rel="showDetails">Show Details</a>
          <div class="details">
            <div class="looks"></div>
            <input name="myOpinion">
          </div>
        </div>
      </script>
    </div>
    <div id="inactiveCustomers" class="customers">
      <script type="text/html-template">
        <div class="customer inactive">
          <h2 class="name"></h2>
          <input name="status">
          <a href="#" class="trigger" rel="showDetails">Show Details</a>
          <div class="details">
            <div class="looks"></div>
            <input name="myOpinion">
          </div>
        </div>
      </script>
    </div>
    <script>
      window.http = {
        get: function(url, callback) {
          console.log(url);
          setTimeout(function() {
            callback([{
              id: 1
            , name: 'brian'
            , status: 'awesome'
            , details: {
                looks: 'average'
              , myOpinion: 6.7
              }
            }
            , {
              id: 2
            , name: 'adrianna'
            , status: 'awesomer'
            , details: {
                looks: 'totally hawt'
              , myOpinion: 'i mean smokin'
              }
            }]);
          }, 50);
        }
      };
    </script>
<!--
    <script src="jquery.min.js"></script>
    <script src="mav.js"></script>
    <script src="wagner.js"></script>
    <script src="eventemitter2.js"></script>
    <script src="caruso.js"></script>
    <script src="caruso.init.js"></script>
    <script src="caruso.dataSource.js"></script>
    <script src="caruso.init.wagner.js"></script>
-->
    <script src="/operatic/client.js"></script>
    <script src="/operatic/util.js"></script>
    <script src="/operatic/oi.js"></script>
    <script src="/operatic/chain.js"></script>
    <script src="/operatic/decorate.js"></script>
    <script src="/wagner/wagner.js"></script>
    <script src="/wagner/wagner.events.js"></script>
    <script src="/wagner/wagner.init.js"></script>
    <script src="/js/mainComponent.js"></script>
    <script src="/js/mainComponent.sub.js"></script>
    <script src="/js/mod.js"></script>
    <script src="/js/component2.js"></script>
<!--
    <script src="/caruso/caruso.js"></script>
    <script src="/caruso/caruso.init.js"></script>
    <script src="/caruso/eventemitter2.js"></script>
    <script src="/caruso/caruso.ajaxDataSource.js"></script>
    <script src="/caruso/caruso.sortedDataSource.js"></script>
    <script src="/caruso/caruso.updateableDataSource.js"></script>
-->
    <script>
/*
(function() {
  var module = new wagner.Module(), exports = module.exports, define = module.define, component = module.component;
  component('activeCustomers', function() {
    var env = this
      ;

    env.addToChain('setting value', 'sucka three', function(data, next) {
      if(data.key === 'looks') {
        data.$match.text("really really really fuckin' hawt");
      } else {
        next();
      }
    });

    env.states({
      initial: 'inactive'
    , inactive: {
        showDetails: {
          before: function($ele, next) {
            next($ele.find('.details'));
          }
          , transition: {
            show: 'slide'
          }
          , endState: 'active'
        }
      }
    , active: {
        showDetails: {
          before: function($ele, next) {
            next($ele.find('.details'));
          }
          , transition: {
            hide: 'slide'
          }
          , endState: 'inactive'
        }
      }
    });

    var ds2 = new caruso.AjaxDataSource('the url');
    var sds = new caruso.SortedDataSource(ds2);
    env.dataSource(sds);
    sds.setSort({
      key: 'name'
    , order: 'desc'
    });
    sds.init();
    setTimeout(function() {
      sds.setSort({
        key: 'status'
      , order: 'desc'
      });
    }, 2000);
    setTimeout(function() {
      sds.add({
        id: 3
      , name: 'adrianna'
      , status: 'awesomer'
      , details: {
          looks: 'totally hawt'
        , myOpinion: 'i mean smokin'
        }
      });
    }, 3000);
  });
})();

(function() {
  var module = new wagner.Module(), exports = module.exports, define = module.define, component = module.component;
  component('inactiveCustomers', function() {
    var env = this
      ;

    env.states({
      initial: 'active'
    , inactive: {
        showDetails: {
          before: function($ele, next) {
            next($ele.find('.details'));
          }
          , transition: {
            show: 'slide'
          }
          , endState: 'active'
        }
      }
    , active: {
        showDetails: {
          before: function($ele, next) {
            next($ele.find('.details'));
          }
          , transition: {
            hide: 'slide'
          }
          , endState: 'inactive'
        }
      }
    });
  });
})();
/*
  $('#customers').children().each(function() {
    console.log($(this).data('caruso.data'));
  });

        source.on('initial data', function(data, key) {
          var $children = $ele.children()
            , matchedData = []
            , unmatchedData = []
            ;
          if($children.length) {
            if(data.hasOwnProperty('length')) {
              var keyedData = {};
              data.forEach(function(dataItem) {
                keyedData[dataItem[key]] = dataItem;
              });
              $children.each(function() {
                var $child = $(this)
                  , $match = $child.find('[name=' + key + ']')
                  , matchVal = $match.val()
                  , matchingData = matchVal && keyedData[matchVal]
                  ;
                if($match.length && matchingData) {
                  $child.data('caruso.data', matchingData);
                }
              });
            }
          } else {
            inject(data);
          }
        });
*/
    </script>
  </body>
</html>
